project_name: wmbus_collector
label: "Flex (RAIL) - Wireless M-bus Collector"
package: Flex
description: "Implements a Wireless M-Bus collector application. Uses the multi-PHY configurator. For details, see AN1119. 
NOTE: Due to the higher current consumption of the continuous radio usage (especially in Rx Mode), it is not recommended to power the boards from a coin cell. Instead, an USB power bank can be used if portability is needed."
category: RAIL Examples
quality: production

#---------------- UC/UP components -------------------
component:
  - id: sl_system
  - id: device_init
  - id: sl_simple_rail_stub
  - id: rail_util_init
    instance:
      - inst0
  - id: rail_util_recommended
  - id: radio_config_wmbus_collector
  - id: sl_flex_assert
  - id: power_manager
  - id: simple_led
    instance:
      - led0
  - id: printf
  - id: iostream_usart
    instance:
      - vcom
  - id: iostream_retarget_stdio
#------------------- WMBUS ---------------------------
  - id: sl_wmbus_support
#------------Memory Protection Unit-------------------
  - id: mpu

#-------------- Restriction rules -------------------
  - id: sl_flex_restrictions_wmbus

#----------------- Require list ----------------------
requires:
  - name: a_radio_config

#----------------- Project files ---------------------
include:
  - path: .
    file_list:
    - path: app_init.h
    - path: app_process.h

source:
  - path: main.c
  - path: app_init.c
  - path: app_process.c

#------------ Configuration overrides ----------------
configuration:
#------------- RAIL init, Project --------------------
  - name: SL_RAIL_UTIL_INIT_INIT_COMPLETE_CALLBACK_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_RADIO_CONFIG_SUPPORT_INST0_ENABLE
    value: "1"
#------------- RAIL init, Protocol -------------------
  - name: SL_RAIL_UTIL_INIT_PROTOCOLS_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_PROTOCOL_INST0_DEFAULT
    value: "SL_RAIL_UTIL_PROTOCOL_PROPRIETARY"
#------------- RAIL init, Auto Transitions -----------
  - name: SL_RAIL_UTIL_INIT_TRANSITIONS_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_TRANSITION_INST0_RX_SUCCESS
    value: "RAIL_RF_STATE_RX"
  - name: SL_RAIL_UTIL_INIT_TRANSITION_INST0_RX_ERROR
    value: "RAIL_RF_STATE_RX"
#------------- RAIL init, Data Format ----------------
  - name: SL_RAIL_UTIL_INIT_DATA_FORMATS_INST0_ENABLE
    value: "1"
#------------- RAIL init, Radio Events ---------------
  - name: SL_RAIL_UTIL_INIT_EVENTS_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_RX_PREAMBLE_LOST_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_RX_PACKET_RECEIVED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_RX_ADDRESS_FILTERED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_RX_FRAME_ERROR_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_RX_PACKET_ABORTED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_TX_PACKET_SENT_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_TX_ABORTED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_TX_BLOCKED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_RX_FIFO_OVERFLOW_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_TX_UNDERFLOW_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_TX_CHANNEL_BUSY_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_RX_TX_SCHEDULED_RX_TX_STARTED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_RX_SCHEDULED_RX_MISSED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_TX_SCHEDULED_TX_MISSED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_CONFIG_UNSCHEDULED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_CONFIG_SCHEDULED_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_SCHEDULER_STATUS_INST0_ENABLE
    value: "1"
  - name: SL_RAIL_UTIL_INIT_EVENT_CAL_NEEDED_INST0_ENABLE
    value: "1"
#------------- MBEDTLS ----------------
  - name: SL_MBEDTLS_HARDWARE_ACCELERATION_ENABLED
    value: "0"
    unless:
      - "device_has_crypto"
#------------- Other project settings ----------------
  - name: SL_BOARD_ENABLE_VCOM
    value: "1"
    condition:
      - iostream_usart
  - name: SL_IOSTREAM_USART_VCOM_CONVERT_BY_DEFAULT_LF_TO_CRLF
    value: "(1)"
  - name: SL_IOSTREAM_USART_VCOM_FLOW_CONTROL_TYPE
    value: "usartHwFlowControlNone"
    condition:
      - iostream_usart
  #------------- WMBus configs -------------------------
  - name: SL_WMBUS_TYPE
    value: "WMBUS_MODE_T_METER" 
    condition:
      - "hardware_board_supports_rf_band_868"
  - name: SL_WMBUS_TYPE
    value: "WMBUS_MODE_F" 
    condition:
      - "hardware_board_supports_rf_band_434"
  - name: SL_WMBUS_TYPE
    value: "WMBUS_MODE_N_48" 
    condition:
      - "hardware_board_supports_rf_band_169"

#--------------------- Toolchain ------------------------
toolchain_settings:
  - option: optimize
    value: debug

ui_hints:
  highlight:
    - path: "config/rail/radio_settings.radioconf"
      focus: true

tag:
  - hardware:
      device:
        memory:
          flash: 93
          ram: 19
      board:
        rf_bands:
          - 169|434|868
        communication:
          - vcom
          - pti
        io:
          led: 2
  
